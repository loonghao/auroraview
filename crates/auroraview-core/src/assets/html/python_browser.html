<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AuroraView Browser</title>
    <style>
        :root {
            --bg-primary: #ffffff;
            --bg-secondary: #f3f3f3;
            --bg-tertiary: #f9f9f9;
            --bg-hover: rgba(0,0,0,0.04);
            --bg-active: rgba(0,0,0,0.08);
            --text-primary: #1a1a1a;
            --text-secondary: #444444;
            --border-color: #e5e5e5;
            --accent-color: #0078d4;
            --url-bar-bg: #ffffff;
        }

        @media (prefers-color-scheme: dark) {
            :root {
                --bg-primary: #1e1e1e;
                --bg-secondary: #2d2d2d;
                --bg-tertiary: #252526;
                --bg-hover: rgba(255,255,255,0.08);
                --bg-active: rgba(255,255,255,0.12);
                --text-primary: #e0e0e0;
                --text-secondary: #999999;
                --border-color: #3d3d3d;
                --accent-color: #0078d4;
                --url-bar-bg: #252526;
            }
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; background: var(--bg-primary); }
        body {
            font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            -webkit-font-smoothing: antialiased;
        }

        /* Tab Bar */
        .tab-bar {
            display: flex;
            background: var(--bg-secondary);
            padding: 4px 8px 0;
            height: 34px;
            gap: 1px;
            align-items: flex-end;
            overflow-x: auto;
            scrollbar-width: none;
        }
        .tab-bar::-webkit-scrollbar { display: none; }

        .tab {
            display: flex;
            align-items: center;
            padding: 0 10px;
            height: 30px;
            background: var(--bg-tertiary);
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            min-width: 120px;
            max-width: 200px;
            font-size: 12px;
            color: var(--text-secondary);
            transition: all 0.1s;
            position: relative;
        }
        .tab.active {
            background: var(--bg-primary);
            color: var(--text-primary);
            z-index: 2;
        }
        .tab:hover:not(.active) { background: var(--bg-hover); }

        .tab-title { flex: 1; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; margin-right: 6px; }
        .tab-close {
            width: 16px; height: 16px; display: flex; align-items: center; justify-content: center;
            border-radius: 4px; opacity: 0; transition: all 0.1s;
        }
        .tab:hover .tab-close { opacity: 0.6; }
        .tab-close:hover { opacity: 1 !important; background: var(--bg-active); }

        .new-tab-btn {
            width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; color: var(--text-secondary); border-radius: 4px; margin-bottom: 2px; margin-left: 4px;
        }
        .new-tab-btn:hover { background: var(--bg-hover); color: var(--text-primary); }

        /* Toolbar */
        .toolbar {
            display: flex; align-items: center; padding: 4px 8px; gap: 6px;
            background: var(--bg-primary); border-bottom: 1px solid var(--border-color); height: 40px;
        }
        .nav-btn {
            width: 28px; height: 28px; display: flex; align-items: center; justify-content: center;
            background: transparent; border: none; border-radius: 4px; color: var(--text-primary); cursor: pointer;
        }
        .nav-btn:hover { background: var(--bg-hover); }
        .nav-btn:disabled { opacity: 0.3; cursor: default; }

        .url-container {
            flex: 1; display: flex; align-items: center; background: var(--bg-secondary);
            border: 1px solid var(--border-color); border-radius: 6px; height: 28px; padding: 0 10px;
        }
        .url-bar { flex: 1; background: transparent; border: none; color: var(--text-primary); font-size: 13px; outline: none; }

        /* Content */
        .content { flex: 1; position: relative; background: var(--bg-primary); }
        iframe { width: 100%; height: 100%; border: none; background: #fff; }

        .loading-bar {
            position: absolute; top: 0; left: 0; right: 0; height: 2px;
            background: var(--accent-color); transform: scaleX(0); transition: transform 0.2s; z-index: 10;
        }
        .loading-bar.active { animation: loading 2s infinite linear; transform: scaleX(1); }
        @keyframes loading {
            0% { transform: translateX(-100%) scaleX(0.2); }
            50% { transform: translateX(0%) scaleX(0.5); }
            100% { transform: translateX(100%) scaleX(0.2); }
        }
    </style>
</head>
<body>
    <div class="tab-bar" id="tabBar">
        <div class="new-tab-btn" onclick="newTab()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>
        </div>
    </div>
    <div class="toolbar">
        <button class="nav-btn" id="backBtn" onclick="goBack()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></svg>
        </button>
        <button class="nav-btn" id="forwardBtn" onclick="goForward()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"/></svg>
        </button>
        <button class="nav-btn" id="reloadBtn" onclick="reloadPage()">
            <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-1.315 3.693a.5.5 0 0 1 .144.693 5 5 0 1 1-.393-5.326.5.5 0 0 1 .744.669 4 4 0 1 0 .285 4.657l-.78-.693z"/></svg>
        </button>
        <div class="url-container">
            <input class="url-bar" id="urlBar" placeholder="Search or enter address" onkeypress="if(event.key==='Enter')navigateToUrl()">
        </div>
    </div>
    <div class="content">
        <div class="loading-bar" id="loadingBar"></div>
        <iframe id="contentFrame" src="about:blank"></iframe>
    </div>
    <script>
        let tabs = [];
        let activeTabId = null;
        const tabBar = document.getElementById('tabBar');
        const urlBar = document.getElementById('urlBar');
        const contentFrame = document.getElementById('contentFrame');
        const loadingBar = document.getElementById('loadingBar');

        window.addEventListener('auroraviewready', () => {
            auroraview.on('tabs:update', data => {
                tabs = data.tabs || [];
                activeTabId = data.activeTabId;
                renderTabs();
                updateUrlBar();
            });
            auroraview.call('browser.get_state').then(data => {
                if (data) { tabs = data.tabs; activeTabId = data.activeTabId; renderTabs(); updateUrlBar(); }
            });
        });

        contentFrame.addEventListener('load', () => {
            loadingBar.classList.remove('active');
            try {
                const url = contentFrame.contentWindow.location.href;
                if (url && url !== 'about:blank') {
                    urlBar.value = url;
                    auroraview.call('browser.navigate', { url: url, silent: true });
                }
            } catch (e) {}
        });

        function renderTabs() {
            const closeIcon = '<svg width="12" height="12" viewBox="0 0 16 16" fill="currentColor"><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>';
            const plusIcon = '<svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor"><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg>';
            tabBar.innerHTML = tabs.map(t => `
                <div class="tab ${t.id === activeTabId ? 'active' : ''}" onclick="activateTab('${t.id}')">
                    <span class="tab-title">${t.title || 'New Tab'}</span>
                    <span class="tab-close" onclick="event.stopPropagation();closeTab('${t.id}')">${closeIcon}</span>
                </div>
            `).join('') + `<div class="new-tab-btn" onclick="newTab()">${plusIcon}</div>`;
        }

        function updateUrlBar() {
            const active = tabs.find(t => t.id === activeTabId);
            if (active && active.url) urlBar.value = active.url;
        }

        function newTab() { auroraview.call('browser.new_tab'); }
        function closeTab(id) { auroraview.call('browser.close_tab', { tabId: id }); }
        function activateTab(id) {
            const tab = tabs.find(t => t.id === id);
            if (tab && tab.url && contentFrame.src !== tab.url) {
                loadingBar.classList.add('active');
                contentFrame.src = tab.url;
            }
            auroraview.call('browser.activate_tab', { tabId: id });
        }
        function navigateToUrl() {
            let url = urlBar.value.trim();
            if (!url) return;
            if (!url.match(/^https?:\/\//i) && !url.startsWith('about:')) {
                url = (url.includes('.') && !url.includes(' ')) ? 'https://' + url : 'https://www.google.com/search?q=' + encodeURIComponent(url);
            }
            loadingBar.classList.add('active');
            contentFrame.src = url;
            auroraview.call('browser.navigate', { url: url });
        }
        function goBack() { try { contentFrame.contentWindow.history.back(); } catch(e) {} auroraview.call('browser.go_back'); }
        function goForward() { try { contentFrame.contentWindow.history.forward(); } catch(e) {} auroraview.call('browser.go_forward'); }
        function reloadPage() { loadingBar.classList.add('active'); contentFrame.src = contentFrame.src; auroraview.call('browser.reload'); }
    </script>
</body>
</html>
