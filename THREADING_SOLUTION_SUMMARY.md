# ğŸ¯ DCC çº¿ç¨‹é€šä¿¡è§£å†³æ–¹æ¡ˆæ€»ç»“

## é—®é¢˜

å½“ WebView åœ¨åå°çº¿ç¨‹è¿è¡Œæ—¶ï¼Œç‚¹å‡» WebView ä¸­çš„æŒ‰é’®ä¼šå¯¼è‡´ Maya å¡ä½ã€‚

**æ ¹æœ¬åŸå› ï¼š**
- WebView äº‹ä»¶å¾ªç¯åœ¨åå°çº¿ç¨‹
- JavaScript å›è°ƒç›´æ¥è°ƒç”¨ Python å‡½æ•°
- Python å‡½æ•°å°è¯•è°ƒç”¨ Maya API
- Maya API ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ â†’ **æ­»é”**

## âœ… è§£å†³æ–¹æ¡ˆï¼šæ¶ˆæ¯é˜Ÿåˆ—æ¨¡å¼

ä½¿ç”¨ **çº¿ç¨‹å®‰å…¨çš„æ¶ˆæ¯é˜Ÿåˆ—** æ¥å®ç°çº¿ç¨‹é—´é€šä¿¡ã€‚

### æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    WebView (åå°çº¿ç¨‹)                    â”‚
â”‚                                                          â”‚
â”‚  JavaScript äº‹ä»¶ â†’ Python å›è°ƒ â†’ æ¶ˆæ¯é˜Ÿåˆ—               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
                    queue.Queue
                   (çº¿ç¨‹å®‰å…¨)
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Maya ä¸»çº¿ç¨‹                           â”‚
â”‚                                                          â”‚
â”‚  å®šæœŸè½®è¯¢é˜Ÿåˆ— â†’ å¤„ç†äº‹ä»¶ â†’ è°ƒç”¨ Maya API                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“¦ æ ¸å¿ƒç»„ä»¶

### 1. DCCEventQueue ç±»

**æ–‡ä»¶ï¼š** `python/auroraview/dcc_event_queue.py`

```python
event_queue = DCCEventQueue()

# æ³¨å†Œå›è°ƒ
event_queue.register_callback("select_object", on_select_object)

# ä»åå°çº¿ç¨‹å‘é€äº‹ä»¶ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
event_queue.post_event("select_object", "pCube1")

# åœ¨ä¸»çº¿ç¨‹å¤„ç†äº‹ä»¶
event_queue.process_events()
```

**ç‰¹æ€§ï¼š**
- âœ“ çº¿ç¨‹å®‰å…¨çš„ `queue.Queue`
- âœ“ æ”¯æŒå¤šä¸ªäº‹ä»¶ç±»å‹
- âœ“ é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•
- âœ“ é˜Ÿåˆ—ç»Ÿè®¡ä¿¡æ¯

### 2. Maya é›†æˆç¤ºä¾‹

**æ–‡ä»¶ï¼š** `examples/maya_event_queue_integration.py`

å®Œæ•´çš„ Maya é›†æˆç¤ºä¾‹ï¼Œå±•ç¤ºï¼š
- å¦‚ä½•åˆ›å»ºäº‹ä»¶é˜Ÿåˆ—
- å¦‚ä½•æ³¨å†Œ Maya å‘½ä»¤å›è°ƒ
- å¦‚ä½•åœ¨ WebView ä¸­å‘é€äº‹ä»¶
- å¦‚ä½•åœ¨ Maya ä¸»çº¿ç¨‹å¤„ç†äº‹ä»¶

## ğŸš€ ä½¿ç”¨æ­¥éª¤

### æ­¥éª¤ 1ï¼šåˆ›å»ºäº‹ä»¶é˜Ÿåˆ—

```python
from auroraview.dcc_event_queue import DCCEventQueue

event_queue = DCCEventQueue()
```

### æ­¥éª¤ 2ï¼šæ³¨å†Œå›è°ƒ

```python
def on_select_object(obj_name):
    import maya.cmds as cmds
    cmds.select(obj_name)

event_queue.register_callback("select_object", on_select_object)
```

### æ­¥éª¤ 3ï¼šåˆ›å»º WebView API

```python
class WebViewAPI:
    def post_event(self, event_name, *args):
        event_queue.post_event(event_name, *args)

webview.set_api(WebViewAPI())
```

### æ­¥éª¤ 4ï¼šåœ¨ Maya ä¸­å¤„ç†äº‹ä»¶

```python
# ä½¿ç”¨ scriptJob å®šæœŸå¤„ç†äº‹ä»¶
cmds.scriptJob(
    event=["idle", event_queue.process_events],
    permanent=True
)
```

## ğŸ’¡ å·¥ä½œåŸç†

```
1. ç”¨æˆ·ç‚¹å‡» WebView ä¸­çš„æŒ‰é’®
   â†“
2. JavaScript äº‹ä»¶è§¦å‘
   â†“
3. JavaScript è°ƒç”¨ Python APIï¼ˆåå°çº¿ç¨‹ï¼‰
   â†“
4. Python å°†äº‹ä»¶æ”¾å…¥é˜Ÿåˆ—ï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰
   â†“
5. Maya ä¸»çº¿ç¨‹å®šæœŸæ£€æŸ¥é˜Ÿåˆ—ï¼ˆé€šè¿‡ scriptJobï¼‰
   â†“
6. ä¸»çº¿ç¨‹ä»é˜Ÿåˆ—å–å‡ºäº‹ä»¶
   â†“
7. ä¸»çº¿ç¨‹æ‰§è¡Œ Maya API è°ƒç”¨
   â†“
8. âœ“ Maya ä¿æŒå“åº”ï¼Œæ²¡æœ‰å¡ä½ï¼
```

## ğŸ“Š æ€§èƒ½ç‰¹æ€§

| ç‰¹æ€§ | å€¼ |
|------|-----|
| äº‹ä»¶å¤„ç†å»¶è¿Ÿ | < 100msï¼ˆé€šå¸¸ï¼‰ |
| é˜Ÿåˆ—å¤§å° | å¯é…ç½®ï¼ˆé»˜è®¤ 1000ï¼‰ |
| çº¿ç¨‹å®‰å…¨ | âœ“ å®Œå…¨çº¿ç¨‹å®‰å…¨ |
| Maya å“åº”æ€§ | âœ“ å®Œå…¨ä¿æŒå“åº” |
| é”™è¯¯å¤„ç† | âœ“ æ”¯æŒé”™è¯¯å›è°ƒ |

## ğŸ” è°ƒè¯•å’Œç›‘æ§

```python
# è·å–é˜Ÿåˆ—ç»Ÿè®¡ä¿¡æ¯
stats = event_queue.get_stats()
print(f"Queue size: {stats['queue_size']}")
print(f"Callbacks: {stats['registered_callbacks']}")

# æ¸…ç©ºé˜Ÿåˆ—
event_queue.clear()

# å¤„ç†äº‹ä»¶å¹¶è·å–å¤„ç†æ•°é‡
count = event_queue.process_events()
print(f"Processed {count} events")
```

## ğŸ“š ç›¸å…³æ–‡ä»¶

- **`DCC_THREADING_SOLUTION.md`** - è¯¦ç»†çš„æŠ€æœ¯æ–‡æ¡£
- **`python/auroraview/dcc_event_queue.py`** - äº‹ä»¶é˜Ÿåˆ—å®ç°
- **`examples/maya_event_queue_integration.py`** - Maya é›†æˆç¤ºä¾‹
- **`examples/maya_quick_test.py`** - å¿«é€Ÿæµ‹è¯•è„šæœ¬

## âœ¨ ä¼˜åŠ¿

âœ“ **çº¿ç¨‹å®‰å…¨** - ä½¿ç”¨ Python æ ‡å‡†åº“ `queue.Queue`
âœ“ **ä¸é˜»å¡ Maya** - WebView åœ¨åå°çº¿ç¨‹ï¼ŒMaya ä¸»çº¿ç¨‹è‡ªç”±
âœ“ **Maya API å…¼å®¹** - æ‰€æœ‰ Maya è°ƒç”¨éƒ½åœ¨ä¸»çº¿ç¨‹
âœ“ **å¯æ‰©å±•** - æ”¯æŒä»»æ„æ•°é‡çš„äº‹ä»¶ç±»å‹
âœ“ **ä½å»¶è¿Ÿ** - äº‹ä»¶å¤„ç†å»¶è¿Ÿå¾ˆå°
âœ“ **é”™è¯¯å¤„ç†** - æ”¯æŒé”™è¯¯å›è°ƒå’Œæ—¥å¿—è®°å½•
âœ“ **æ˜“äºä½¿ç”¨** - ç®€å•çš„ APIï¼Œæ˜“äºé›†æˆ

## ğŸ¯ ä¸‹ä¸€æ­¥

1. **æµ‹è¯•äº‹ä»¶é˜Ÿåˆ—**
   ```bash
   uv run pytest tests/ -v
   ```

2. **åœ¨ Maya ä¸­æµ‹è¯•**
   - æ‰“å¼€ Maya 2022
   - è¿è¡Œ `examples/maya_event_queue_integration.py`
   - ç‚¹å‡»æŒ‰é’®ï¼ŒéªŒè¯ Maya ä¿æŒå“åº”

3. **é›†æˆåˆ°ç”Ÿäº§ä»£ç **
   - ä¿®æ”¹ç°æœ‰çš„ WebView é›†æˆ
   - ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—æ›¿ä»£ç›´æ¥ API è°ƒç”¨
   - æ·»åŠ æ›´å¤šäº‹ä»¶ç±»å‹

4. **ä¼˜åŒ–å’Œæ‰©å±•**
   - æ·»åŠ äº‹ä»¶ä¼˜å…ˆçº§
   - å®ç°äº‹ä»¶è¿‡æ»¤
   - æ·»åŠ äº‹ä»¶å†å²è®°å½•

## ğŸ“– å‚è€ƒèµ„æº

- Python `queue.Queue` æ–‡æ¡£ï¼šhttps://docs.python.org/3/library/queue.html
- Maya Python APIï¼šhttps://help.autodesk.com/view/MAYAUL/2022/ENU/
- çº¿ç¨‹å®‰å…¨ç¼–ç¨‹ï¼šhttps://docs.python.org/3/library/threading.html

---

**ç°åœ¨å°±å¼€å§‹ä½¿ç”¨äº‹ä»¶é˜Ÿåˆ—å§ï¼** è¿™æ˜¯è§£å†³ DCC çº¿ç¨‹é€šä¿¡é—®é¢˜çš„æ ‡å‡†æ¨¡å¼ã€‚

